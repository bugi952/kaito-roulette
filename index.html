<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ° Yappers ìŠ¬ë¡¯ ë£°ë › (ì‹¬í”Œ Â· ëœë¤ ìˆœì„œ)</title>
<style>
  :root{ --accent:#6c5ce7; --bg1:#f5f8ff; --bg2:#eaf3ff }
  html,body{height:100%;margin:0}
  body{
    display:grid;place-items:center;text-align:center;
    font-family:ui-sans-serif,system-ui,Apple SD Gothic Neo,Malgun Gothic,sans-serif;
    background:radial-gradient(1200px 600px at 50% -10%, var(--bg1), var(--bg2)); color:#111;
  }
  main{ width:min(680px,92vw) }
  .slot{ width:220px;height:220px;border-radius:28px;background:#fff; display:grid;place-items:center;margin:12px auto 18px; box-shadow:0 22px 45px rgba(0,0,0,.12), inset 0 0 0 1px #e5e7eb; overflow:hidden }
  .slot.fast{ animation:bump .15s infinite }
  @keyframes bump{ 0%{transform:translateY(0)} 50%{transform:translateY(2px)} 100%{transform:translateY(0)} }
  .slot.fast img{ filter:blur(1px) saturate(1.1) }
  .logo{ width:88%;height:88%;object-fit:contain; display:block }
  .fallback{ width:100%;height:100%;display:grid;place-items:center;font-weight:900;font-size:64px;color:#fff;background:linear-gradient(135deg,var(--accent),#4b39c5) }
  .btn{ padding:14px 34px;border:none;border-radius:999px;cursor:pointer;color:#fff;font-weight:800;font-size:18px;background:linear-gradient(135deg,var(--accent),#4b39c5);box-shadow:0 12px 28px rgba(0,0,0,.16);transition:transform .08s, filter .2s }
  .btn:hover{ filter:brightness(1.05) } .btn:active{ transform:translateY(1px) scale(.98) }
  .btn[disabled]{ opacity:.6; cursor:not-allowed }
  #result{ margin-top:18px; min-height:48px }
  #result .name{ font-size:28px; font-weight:900; margin-bottom:6px }
  #result .msg{ font-size:16px; color:#374151 }
</style>
</head>
<body>
  <main>
    <div id="slot" class="slot"><div class="fallback">?</div></div>
    <!-- âœ¨ ë²„íŠ¼ì€ ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ëœ ìƒíƒœë¡œ ì‹œì‘ -->
    <button id="startBtn" class="btn">Start</button>
    <div id="result"></div>
  </main>

<script>
/*
  ë³€ê²½ ìš”ì•½
  - â–¶ í”„ë¦¬ë¡œë“œë¥¼ 'ê¸°ë‹¤ë¦¬ì§€ ì•Šê³ ' ë²„íŠ¼ ì¦‰ì‹œ í™œì„±í™” (UX ê³ ì •)
  - â–¶ í™•ì¥ì í›„ë³´ë¥¼ í˜„ì‹¤ì ì¸ 5ê°œë¡œ ì¶•ì†Œ: webp/png/jpg/jpeg/svg
  - â–¶ ê³µë°±/ì  ë“± íŒŒì¼ëª… ìë™ ë³€í˜• í›„ë³´ë¥¼ ì‹œë„ (ê³µë°±â†’_/-, ì  ì œê±°)
  - â–¶ ìŠ¤í•€ ì¤‘ í•´ë‹¹ í•­ëª©ì´ ë¯¸ìºì‹œì´ë©´ ê·¸ë•Œ í•œ ë²ˆë§Œ ë¡œë“œ(ê²Œìœ¼ë¥¸ ë¡œë“œ)
*/

const items = [
  { name:"Anoma", base:"Anoma" }, { name:"Aptos", base:"Aptos" },
  { name:"Beldex", base:"Beldex" }, { name:"Bitdealer", base:"Bitdealer" },
  { name:"Bless", base:"Bless" }, { name:"Cysic", base:"Cysic" },
  { name:"Falcon Finance", base:"Falcon Finance" }, { name:"GOAT Network", base:"GOAT Network" },
  { name:"Hana", base:"Hana" }, { name:"Huma Finance", base:"Huma Finance" },
  { name:"Hyperpie", base:"Hyperpie" }, { name:"Infinex", base:"Infinex" },
  { name:"Lombard", base:"Lombard" }, { name:"Lumiterra", base:"Lumiterra" },
  { name:"Mavryk Network", base:"Mavryk Network" }, { name:"Metawin", base:"Metawin" },
  { name:"Mira", base:"Mira" }, { name:"MultiBank", base:"MultiBank" },
  { name:"Multipli.fi", base:"Multipli.fi" }, { name:"Novastro", base:"Novastro" },
  { name:"peaq", base:"peaq" }, { name:"Polygon", base:"Polygon" },
  { name:"Puffpaw", base:"Puffpaw" }, { name:"Pyth", base:"Pyth" },
  { name:"Somnia", base:"Somnia" }, { name:"Surf", base:"Surf" },
  { name:"Talus Labs", base:"Talus Labs" }, { name:"Theoriq", base:"Theoriq" },
  { name:"Turtle", base:"Turtle" }, { name:"UXLINK", base:"UXLINK" },
  { name:"Brevis", base:"Brevis" }, { name:"Billions", base:"Billions" },
  { name:"Everlyn", base:"Everlyn" }, { name:"Monad", base:"Monad" },
  { name:"Sentient", base:"Sentient" }, { name:"momentum", base:"momentum" },
  { name:"Sonic", base:"Sonic" }, { name:"Allora Network", base:"Allora Network" },
  { name:"Warden", base:"Warden" }, { name:"XION", base:"XION" }
];

const slot = document.getElementById('slot');
const startBtn = document.getElementById('startBtn');
const result = document.getElementById('result');

let intervalId = null;
let stopTimer  = null;
let spinOrder  = [];
let pos        = 0;

// base -> ì„±ê³µ ê²½ë¡œ(String) ë˜ëŠ” null(ì—†ìŒ)
const srcCache = new Map();

function initials(name){
  const parts = (name||'?').trim().split(' ').filter(Boolean);
  return parts.slice(0,2).map(w=>w[0]).join('').toUpperCase();
}
function fallbackBlock(name){
  const d=document.createElement('div');
  d.className='fallback';
  d.textContent=initials(name||'?');
  return d;
}

/* âœ¨ í˜„ì‹¤ì ì¸ í™•ì¥ì í›„ë³´(ëŒ€ì†Œë¬¸ì í˜¼ìš© ì—†ì´) */
const EXTS = ["webp","png","jpg","jpeg","svg"];

/* âœ¨ íŒŒì¼ëª… ë³€í˜• í›„ë³´: ê³µë°±â†’_/-, ì  ì œê±°, ê³µë°±/ì  ëª¨ë‘ ì œê±° */
function filenameCandidates(base){
  const cands = [
    base,
    base.replace(/\s+/g,'_'),
    base.replace(/\s+/g,'-'),
    base.replace(/\./g,''),
    base.replace(/\s+/g,'').replace(/\./g,''),
  ];
  return [...new Set(cands)];
}

/* ë‹¨ì¼ ì´ë¯¸ì§€ ë¡œë“œ (ì„±ê³µ: src, ì‹¤íŒ¨: null) */
function loadOnce(src, timeoutMs=7000){
  return new Promise((resolve)=>{
    const img = new Image();
    const t = setTimeout(()=>{ cleanup(); resolve(null); }, timeoutMs);
    function cleanup(){ clearTimeout(t); img.onload = img.onerror = null; }
    img.onload = ()=>{ cleanup(); resolve(src); };
    img.onerror = ()=>{ cleanup(); resolve(null); };
    img.src = src;
  });
}

/* ê°€ëŠ¥í•œ í›„ë³´ë“¤ì„ ìˆœì°¨ ì‹œë„ (ë¶ˆí•„ìš”í•œ ë™ì‹œ í­ì£¼ ë°©ì§€) */
async function tryFindImage(base){
  const bases = filenameCandidates(base);
  for(const b of bases){
    const enc = encodeURIComponent(b);
    for(const ext of EXTS){
      const src = `images/${enc}.${ext}`;
      const ok = await loadOnce(src);
      if (ok) return ok;
    }
  }
  return null;
}

/* â–¶ ë°±ê·¸ë¼ìš´ë“œ í”„ë¦¬ë¡œë“œ: ë™ì‹œ 6ê°œë¡œ ì œí•œ */
async function preload(all = items){
  const CONCURRENCY = 6;
  let i = 0;
  async function worker(){
    while (i < all.length){
      const idx = i++;
      const it = all[idx];
      if (!srcCache.has(it.base)){
        const found = await tryFindImage(it.base);
        srcCache.set(it.base, found); // ì‹¤íŒ¨ë„ nullë¡œ ìºì‹œ
      }
    }
  }
  await Promise.all(Array.from({length:CONCURRENCY}, worker));
}

function showItem(item, fast=false){
  slot.classList.toggle('fast', fast);
  const cached = srcCache.get(item.base);
  if (cached){
    slot.innerHTML = `<img class="logo" alt="${item.name}" src="${cached}">`;
  }else{
    // â–¶ ìºì‹œ ì—†ìœ¼ë©´ ì¦‰ì„ 1íšŒ ì‹œë„(ê²Œìœ¼ë¥¸ ë¡œë“œ)
    ensureImage(item);
    slot.replaceChildren(fallbackBlock(item.name));
  }
}

/* â–¶ ìŠ¤í•€ ì¤‘ ì²˜ìŒ ë³´ëŠ” í•­ëª©ì€ ê·¸ë•Œ í•œ ë²ˆë§Œ íƒìƒ‰ */
const pendingLookups = new Set();
async function ensureImage(item){
  if (srcCache.has(item.base)) return;
  if (pendingLookups.has(item.base)) return;
  pendingLookups.add(item.base);
  const found = await tryFindImage(item.base);
  srcCache.set(item.base, found ?? null);
  pendingLookups.delete(item.base);
  // ì´ë¯¸ í™”ë©´ì— í•´ë‹¹ í•­ëª©ì´ ë–  ìˆë‹¤ë©´ ê°±ì‹ 
  const current = slot.querySelector('img')?.alt;
  if (current !== item.name && found) return;
  if (found){
    slot.innerHTML = `<img class="logo" alt="${item.name}" src="${found}">`;
  }
}

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

function startSpin(){
  if (startBtn.disabled) return;
  if (intervalId) return;
  result.innerHTML = '';
  startBtn.disabled = true;

  // ìƒˆ ìŠ¤í•€ë§ˆë‹¤ ìˆœì„œë¥¼ ëœë¤ ì„ê¸°
  spinOrder = shuffle([...Array(items.length).keys()]);
  pos = 0;
  slot.classList.add('fast');

  intervalId = setInterval(()=>{
    const i = spinOrder[pos];
    pos = (pos + 1) % spinOrder.length;
    showItem(items[i], true);
  }, 50);

  stopTimer = setTimeout(stopSpin, 2000);
}

function stopSpin(){
  if (intervalId) { clearInterval(intervalId); intervalId = null; }
  if (stopTimer)  { clearTimeout(stopTimer);  stopTimer  = null; }
  slot.classList.remove('fast');

  const lastPos = (pos - 1 + spinOrder.length) % spinOrder.length;
  const chosen = items[spinOrder[lastPos]];
  showItem(chosen, false);

  result.innerHTML = `
    <div class="name">${chosen.name}</div>
    <div class="msg">ì¶•í•˜í•©ë‹ˆë‹¤. ë‹¹ì‹ ì€ "<b>${chosen.name}</b>" Yapperë¡œ ì„ ì •ë˜ì…¨ìŠµë‹ˆë‹¤.</div>
  `;
  startBtn.disabled = false;
  startBtn.textContent = 'Start';
}

startBtn.addEventListener('click', startSpin);

/* â–¶ ì´ˆê¸°í™”: í”„ë¦¬ë¡œë“œ 'ê¸°ë‹¤ë¦¬ì§€ ì•Šê³ ' ì¦‰ì‹œ ì‹œì‘ ê°€ëŠ¥ */
(function init(){
  slot.replaceChildren(fallbackBlock('?'));
  startBtn.disabled = false;
  startBtn.textContent = 'Start';
  preload().catch(console.warn); // ë°±ê·¸ë¼ìš´ë“œ í”„ë¦¬ë¡œë“œ
  // ë³´ìˆ˜ì  ì¬ë³´ì¥
  setTimeout(()=>{ startBtn.disabled=false; startBtn.textContent='Start'; }, 1200);
})();
</script>
</body>
</html>
